# ベンチマーク

chaseは高速です。以下の結果をご覧ください。

## Dart Webフレームワーク比較

同一マシンでの他のDart Webフレームワークとの比較です。

### 比較対象フレームワーク

| フレームワーク | 説明 |
|---------------|------|
| **chase** | Trieベースルーター、最小限のオーバーヘッド |
| **shelf** | Dartチーム公式Webサーバーミドルウェア |
| **dart_frog** | VGVのフルスタックDartフレームワーク |
| **dart:io** | 生のHttpServer（ベースライン） |

### 結果

<img src="/chase/assets/benchmark-result.png" alt="Benchmark Results" width="600">

| テスト | chase | dart:io | Shelf | Dart Frog | chase vs dart:io |
|--------|-------|---------|-------|-----------|------------------|
| Plain Text | 72,187 | 72,391 | 42,206 | 41,006 | 99.7% |
| JSON | 66,233 | 68,908 | 38,863 | 38,135 | 96.1% |
| Route Params | 65,681 | 60,256 | 36,721 | 36,695 | 109% |
| Query Params | 63,154 | 65,237 | 36,534 | 35,483 | 96.8% |
| Large JSON | 8,053 | 8,110 | 7,812 | 7,643 | 99.3% |
| Middleware | 63,308 | 71,117 | 37,937 | 37,093 | 89.0% |

> Apple M4、Dart 3.10、JITモード、100同時接続、10秒間でテスト。

### テストしたエンドポイント

| テスト | エンドポイント | 説明 |
|--------|---------------|------|
| **プレーンテキスト** | `GET /` | シンプルな "Hello, World!" レスポンス |
| **JSON** | `GET /json` | JSONオブジェクトのシリアライズ |
| **ルートパラメータ** | `GET /user/:id` | 動的ルートパラメータの抽出 |
| **クエリパラメータ** | `GET /query?name=x&age=y` | URLクエリ文字列のパース |
| **大きなJSON** | `GET /large` | 100アイテムの配列シリアライズ |
| **ミドルウェア** | `GET /middleware` | 3層のミドルウェアチェーン |

## なぜchaseは速いのか？

### Trieベースルーター

chaseはTrieベースルーターを使用し、O(k)のルートマッチングを実現しています（kはパスの深さ）。これは一部のフレームワークで使用される線形マッチングよりも大幅に高速です。

```
登録されたルート:
  /users
  /users/:id
  /users/:id/posts
  /users/:id/posts/:postId

/users/123/posts/456 のマッチング:
  Trie:   O(4) - 4ノードを走査
  Linear: O(n) - マッチするまで全ルートをチェック
```

### 最小限の抽象化

chaseは抽象化を最小限に抑えています。リクエスト処理はルーターからハンドラーへ直接流れ、中間処理を最小化しています。

### AOTコンパイル

DartのAOTコンパイルはネイティブ実行ファイルを生成し、以下を実現します：
- 即時起動（JITウォームアップなし）
- 低メモリフットプリント
- 一貫したパフォーマンス

## 自分でベンチマークを実行

```bash
cd benchmark
./run.sh --aot
```

完全なベンチマークスイートは [benchmark/](https://github.com/user/chase/tree/main/benchmark) を参照してください。

## 測定方法

- **ツール**: wrk または hey
- **時間**: テストごとに10秒
- **接続数**: 100同時接続
- **スレッド**: 4
- **モード**: AOTコンパイル (`dart compile exe`)

公平な比較のため、すべてのフレームワークで同一のエンドポイントを実装しています。
